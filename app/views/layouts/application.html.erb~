<!DOCTYPE html>
<html>
<head>
  <title>Store</title>
 <%= stylesheet_link_tag    "application", :media => "all" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
  <script src="http://js.pusher.com/2.0/pusher.min.js"></script>
  <script src="/javascripts/jquery.titlealert.js"></script>
<%= stylesheet_link_tag    "application", :media => "all" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>

<style>
.alert-minimalist {
	background-color: rgb(241, 242, 240);
	border-color: rgba(149, 149, 149, 0.3);
	border-radius: 3px;
	color: rgb(149, 149, 149);
	padding: 10px;
}
.alert-minimalist > [data-notify="icon"] {
	height: 50px;
	margin-right: 12px;
}
.alert-minimalist > [data-notify="title"] {
	color: rgb(51, 51, 51);
	display: block;
	font-weight: bold;
	margin-bottom: 5px;
}
.alert-minimalist > [data-notify="message"] {
	font-size: 80%;
}
</style>
     <script type="text/javascript" charset="utf-8">

      $(function() {

            var pusher = new Pusher('b79e3ab119cc8a15cad7'); // Replace with your app key
    	    var channel = pusher.subscribe('private-'+<%= current_user.id.to_s if current_user %>);

     channel.bind('client-new_message', function(data) {
$(document).ready(function() {
$.notify({
	icon: data.image_url,
	title: 'Alert!,
	message: data.stock_symbol + ' has hit the price of ' + data.target
},{
	type: 'minimalist',
	delay: 5000,
	icon_type: 'image',
	template: '<div data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0}" role="alert">' +
		'<img data-notify="icon" class="img-circle pull-left">' +
		'<span data-notify="title">{1}</span>' +
		'<span data-notify="message">{2}</span>' +
	'</div>'
});
});
});

    /*  msg = data.stock_symbol + 'has hit the price of' + data.target + " with a current value of " + data.stock_price ;
      Notification.requestPermission( function () {
        var notification = new Notification ('pop', {
          body: msg
        });
      })
  });

   function dom_notify(msg) {
  $('#notify').text(msg);
  $('#notify').fadeIn();
  setTimeout(function() {
    $('#notify').fadeOut
    ();
  }, 20000);
}

*/
 
      });



    // Some useful debug msgs
    pusher.connection.bind('connecting', function() {
      $('div#status').text('Connecting to Pusher...');
    });
    pusher.connection.bind('connected', function() {
      $('div#status').text('Connected to Pusher!');
    });
    pusher.connection.bind('failed', function() {
      $('div#status').text('Connection to Pusher failed :(');
    });
    channel.bind('subscription_error', function(status) {
      $('div#status').text('Pusher subscription_error');
    });

   


    </script>


  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
  <![endif]-->
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>


<div class="container">

  <!-- Static navbar -->
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Market-Watch 166b</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li class="active"><a href="#">Home</a></li>
          <li><%= link_to "Stocks", stocks_path  %></li>
          <li><%= link_to "My Porfolio", portfolio_path(current_portfolio) unless current_portfolio == nil %></li>          <li><%= link_to "Rules", rules_path %></li>
        </ul>
        <ul class="nav navbar-nav navbar-right" >
          <%= button_to 'Logout', logout_path, :method => :delete %>
        </ul>
      </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
  </nav>

  <div class="container">
    <div class="row">
      <div class="span9"><%= yield %></div>
      <div class="span3">
        <h2>About Us</h2>
        We are a team of four students from cosi 166b Software Engineering class. <br> This is a is site which allows you to manage stock portfolio, monitor the market,<br> apply your rules and it sends you buy and sell reminders.
      </div>
    </div>
  </div>

</body>
</html>
